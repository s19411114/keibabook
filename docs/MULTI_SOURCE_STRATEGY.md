# マルチソース・スクレイピング戦略

## 📖 概要

このアプリケーションは、**複数のデータソースを組み合わせて最適なデータ取得を行う**設計になっています。

## 🎯 なぜ複数のサイトを使うのか？

### 1. **サイトへの負担軽減**（最重要）

競馬ブックは有料サービスであり、多くの投資家・予想家が利用しています。特にレース中は以下の問題があります：

- ⚠️ **レース中は非常に重い**：アクセスが集中して応答が遅くなる
- 🚫 **過度なアクセスは迷惑**：サーバー負荷を上げてしまう
- 👥 **他のユーザーへの配慮**：自動化ツール利用者が増えている中、サイトを守る必要がある

**倫理的責任**：限られたリソースを公平に使用し、サイト運営者と他のユーザーに迷惑をかけないこと。

### 2. **データの読みやすさ・取得効率**

各サイトには得意分野があります：

| サイト | 得意な情報 | メリット |
|--------|-----------|----------|
| **KeibaBook** | 予想印、コメント、調教 | 専門的な分析情報が豊富 |
| **Netkeiba** | スケジュール、過去成績 | 読みやすい、軽い、速い |
| **JRA公式** | リアルタイムオッズ | 公式データで正確 |

### 3. **レース中の最適化**

**レース中のアクセスパターン**：
- ❌ **避けるべき**: 競馬ブックにリアルタイムで何度もアクセス（重い）
- ✅ **推奨**: Netkeibaでスケジュール確認 → JRA公式でオッズ取得（軽い）

## 🏗️ 実装されているマルチソース戦略

### スケジュール取得の優先順位

#### JRA（中央競馬）

```
1. Netkeiba カレンダー（優先）
   ↓ 失敗時
2. JRA 公式カレンダー
   ↓ 失敗時
3. keiba.go.jp Today（最終手段）
```

**理由**: Netkeibaが最も読みやすく、軽量でアクセスが速い

#### NAR（地方競馬）

```
1. NAR/Netkeiba スケジュール
   ↓ 失敗時
2. keiba.go.jp（フォールバック）
```

### データ取得の役割分担

| データ種類 | 主ソース | 理由 |
|-----------|----------|------|
| 出馬表・予想印 | **KeibaBook** | 専門的な予想情報 |
| スケジュール | **Netkeiba** | 軽量・高速 |
| リアルタイムオッズ | **JRA公式** | 正確性 |
| 過去成績 | **Netkeiba** | データ量が豊富 |
| トラックバイアス | **Netkeiba** | レース結果の分析に最適 |

## ⚖️ 倫理的ガイドライン

### 1. レート制限の遵守

- ⏱️ **推奨間隔**: 10分以上（設定可能）
- 🔄 **重複チェック**: 同じデータを何度も取得しない
- 💾 **キャッシュ活用**: 一度取得したデータは再利用

### 2. サイトへの配慮

```python
# 推奨設定例
settings = {
    'rate_limit_seconds': 600,  # 10分間隔
    'use_duplicate_check': True,  # 重複防止
    'headless_mode': True,  # 軽量モード
}
```

### 3. 時間帯の考慮

- 🕐 **レース当日の昼～夕方**: 最もアクセスが集中
  - → Netkeibaやキャッシュを積極活用
- 🌙 **深夜～早朝**: サーバー負荷が低い
  - → この時間帯に翌日分をまとめて取得

## 🛡️ robots.txt と利用規約の遵守

各サイトの `robots.txt` と利用規約を必ず確認してください：

- **KeibaBook**: 過度なアクセスを避ける（有料会員向けサービス）
- **Netkeiba**: 公開情報のみ取得
- **JRA公式**: オッズAPIの利用制限を守る

## 📝 まとめ

**マルチソース戦略の目的**：

1. ✅ サイト運営者への配慮（負荷軽減）
2. ✅ 他のユーザーへの配慮（リソースの公平な利用）
3. ✅ データ取得の効率化（適材適所）
4. ✅ アプリケーションの信頼性向上（フォールバック）

**この戦略により、すべての関係者にメリットがある持続可能なシステムを実現しています。**

---

## 🔧 カスタマイズ

設定ファイル `config/settings.yml` で各ソースの優先順位やレート制限を調整できます。サイトの状況や自分の利用パターンに合わせて最適化してください。
