# 開発ロードマップ

## 現時点の方針（短期）

### データ取得方法
- **馬柱から過去走を取得**（個別馬ページは開かない）
- **過去3走分を取得**（予想に必要）
- **結果ページはレース終了後にスクレイピング**（現時点ではスキップ）

### 取得するデータ
1. **出馬表ページ**
   - レース基本情報
   - 馬の基本情報（馬番、馬名、騎手など）
   - 馬柱（過去3走分）

2. **調教ページ**
   - 調教データ

3. **血統ページ**
   - 父、母、母父など（個別馬ページより詳しい）

4. **コメントページ**
   - 厩舎の話
   - 前走コメント

### データ保存
- **CSV形式**: データベース用（重複チェック対応）
- **JSON形式**: AI用（1レース分の詳細情報）

## 長期的な方針

### データ蓄積フェーズ（数週間〜数ヶ月）
1. **毎日のレースデータを収集**
   - 出馬表から予想用データを取得
   - レース終了後、結果ページから詳細情報を取得

2. **過去データの蓄積**
   - 過去1年〜3年分のデータを収集
   - 結果ページから詳細な過去走データを取得

### 特徴量エンジニアリングフェーズ
1. **蓄積されたデータから特徴量を抽出**
   - 過去走の統計情報
   - 調教パターン
   - 血統特徴
   - コース適性など

2. **AIモデルへの入力データを最適化**
   - 過去データを基にした特徴量を生成
   - 予想精度向上のためのデータ加工

## 実装の優先順位

### Phase 1: 基本スクレイピング（現在）
- [x] 出馬表ページの取得
- [x] 調教ページの取得
- [x] 血統ページの取得
- [x] コメントページの取得
- [x] 馬柱から過去3走分の取得
- [x] CSV DB管理
- [x] Streamlit GUI
- [x] レコメンド機能（過小評価馬検出）

### Phase 2: データ蓄積（今後）
- [ ] 定期実行機能（朝の自動収集）
- [ ] 結果ページのスクレイピング（レース後）
- [ ] 過去レースの一括取得
- [ ] データの差分更新機能

### Phase 3: 特徴量エンジニアリング（将来）
- [ ] 過去データからの統計特徴量抽出
- [ ] 調教パターン分析
- [ ] 血統特徴の数値化
- [ ] コース適性の分析

### Phase 4: 高度なレコメンド機能（将来）
- [ ] 複数条件を組み合わせた検出
- [ ] 機械学習モデルによる予測
- [ ] 買い目アドバイス機能

## 注意事項

### 馬柱パーサーの調整
- 実際のHTML構造に合わせて`_parse_horse_table_data`のセレクタを調整が必要
- `debug_page.html`を確認して、実際の構造を把握

### 結果ページの取得タイミング
- レース前: 出馬表から予想用データを取得
- レース後: 結果ページから詳細情報を取得してデータベースに追加

### データ収集の時間
- 過去1年分: 数週間かかる見込み
- 過去3年分: 数ヶ月かかる見込み
- レート制限を考慮して、時間をかけて収集

